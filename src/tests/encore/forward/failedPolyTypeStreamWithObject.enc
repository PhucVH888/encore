-- Error related to unknown _enc_type_t in method produce()
-- read class Bar
--   val v : int
--   def init(v : int) : unit
--     this.v = v
--   end
--   def getter() : int
--     this.v
--   end
-- end
active class Foo[t]
  stream produce(var n : int, v : t) : t
    while n>0 do
      yield(v)
      n -= 1
    end
  end
end
active class Main
  def main() : unit
    val foo = new Foo[int]
    val s = foo!produce(10, 42)
  end
end

-- With the concrete type of stream, it works properly.
{-
read class Bar
  val v : int
  def init(v : int) : unit
    this.v = v
  end
  def getter() : int
    this.v
  end
end
active class Foo
  stream produce(var n : int) : Bar
    while n>0 do
      yield(new Bar(n))
      n -= 1
    end
  end
end
active class Main
  def printStream(var s : Stream[Bar]) : unit
    while not(eos(s)) do
      println("{}", (get(s)).getter())
      s = getNext(s)
    end
  end
  def main() : unit
    val foo = new Foo
    val s = foo!produce(10)
    this.printStream(s)
  end
end
-}
